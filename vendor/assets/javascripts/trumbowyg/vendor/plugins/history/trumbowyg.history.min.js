!function(i){"use strict";i.extend(!0,i.trumbowyg,{langs:{de:{history:{redo:"Wiederholen",undo:"Rückgängig"}},en:{history:{redo:"Redo",undo:"Undo"}}},plugins:{history:{init:function(o){var t=o;t.o.plugins.history=i.extend(!0,{_stack:[],_index:-1,_focusEl:void 0},t.o.plugins.history||{});var n={title:t.lang.history.redo,ico:"redo",key:"Y",fn:function(i){if(t.o.plugins.history._index<t.o.plugins.history._stack.length-1){var o=++t.o.plugins.history._index,n=t.o.plugins.history._stack[o];t.execCmd("html",n),t.o.plugins.history._stack[o]=t.$ed.html(),u(),l()}}},s={title:t.lang.history.undo,ico:"undo",key:"Z",fn:function(i){if(t.o.plugins.history._index>0){var o=--t.o.plugins.history._index,n=t.o.plugins.history._stack[o];t.execCmd("html",n),t.o.plugins.history._stack[o]=t.$ed.html(),u(),l()}}},e=function(o){var n,s,e=t.o.plugins.history._index,r=t.o.plugins.history._stack,u=r.slice(-1)[0]||"<p></p>",h=r[e],c=t.$ed.html(),g=t.doc.getSelection().focusNode,a="",y=t.o.plugins.history._focusEl;t.o.plugins.history.limit;n=i("<div>"+u+"</div>").find("*").map(function(){return this.localName}),s=i("<div>"+c+"</div>").find("*").map(function(){return this.localName}),g&&(t.o.plugins.history._focusEl=g,a=g.outerHTML||g.textContent),c!=h&&(a.slice(-1).match(/\s/)||!d(n,s)||t.o.plugins.history._index<=0||g!=y?(t.o.plugins.history._index++,t.o.plugins.history._stack=r.slice(0,t.o.plugins.history._index),t.o.plugins.history._stack.push(c)):t.o.plugins.history._stack[e]=c,l())},l=function(){var i=t.o.plugins.history._index,o=t.o.plugins.history._stack.length,n=i>0,s=0!=o&&i!=o-1;r("historyUndo",n),r("historyRedo",s)},r=function(i,o){var n=t.$box.find(".trumbowyg-"+i+"-button");o?n.removeClass("trumbowyg-disable"):n.hasClass("trumbowyg-disable")||n.addClass("trumbowyg-disable")},d=function(i,o){if(i===o)return!0;if(null==i||null==o)return!1;if(i.length!=o.length)return!1;for(var t=0;t<i.length;++t)if(i[t]!==o[t])return!1;return!0},u=function(){var i=t.doc.getSelection().focusNode,o=t.doc.createRange();i.childNodes.length>0&&(o.setStartAfter(i.childNodes[i.childNodes.length-1]),o.setEndAfter(i.childNodes[i.childNodes.length-1]),t.doc.getSelection().removeAllRanges(),t.doc.getSelection().addRange(o))};t.$c.on("tbwinit tbwchange",e),t.addBtnDef("historyRedo",n),t.addBtnDef("historyUndo",s)}}}})}(jQuery);